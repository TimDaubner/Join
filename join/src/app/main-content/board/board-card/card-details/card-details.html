@if (isTaskDetailsOpen) {
<div class="overlay" (click)="closeTaskDetails()">
    <div class="task_details" (click)="$event.stopPropagation()">

        @if (!isEditOverlayOpen) {

        <div class="category_and_close_btn">
            <!-- Category badge -->
            <div class="task_category" [ngClass]="(selectedTask?.taskCategory ?? '').replace(' ', '')">
                {{
                selectedTask?.taskCategory }}
            </div>

            <button class="close_btn" (click)="closeTaskDetails()"><img src="/assets/icons/close.svg"
                    alt="Close"></button>
        </div>

        <!-- Title -->
        <h2 class="task_title_large">
            {{ selectedTask?.title }}
        </h2>

        <!-- Description -->
        <p class="task_description_large">
            {{ selectedTask?.description }}
        </p>
        <div class="detail_row">
            <span class="label">Due date: {{selectedTask?.dueDate}}</span>
            <span> </span>
        </div>
        <div class="detail_row priority">
            <span class="label">Priority:</span>
            @if (selectedTask?.priority) {
            <span class="priority_icon">
                {{selectedTask?.priority}}<img [src]="getPriorityIcon(selectedTask?.priority)" alt="Priority icon">
            </span>
            }
        </div>

        <!-- Assigned To -->
        <div class="assignedTo_section">
            <b class="assigned">Assigned To:</b>
            @for (assignee of selectedTask?.assignedTo; track $index) {
            <span class="label column">
                @for (contact of this.contact_service.contactList; track $index; let index = $index) {
                    @if(assignee == this.getFullName(contact.surname,contact.lastname)){
                        <div class="img" [style.background-color]="contact.color">
                            {{this.getInitials(assignee)}}
                        </div>
                    }
                }
                <div>{{ assignee }}</div>
            </span>
            }
        </div>

        <!-- Checkboxes subtasks -->
        @if (selectedTask?.subTask?.length) {
        <div class="label header_subtasks">Subtasks</div>

        <div class="subtask_list">
            @for (sub of selectedTask?.subTask ?? []; track sub.id) {
            <label class="subtask_item" (click)="toggleSubtask(sub, $event)">
                <img class="checkbox_icon" [src]="sub.status 
            ? '/assets/icons/checked.svg' 
            : '/assets/icons/unchecked.svg'" alt="Checkbox"
                    (click)="$event.stopPropagation(); toggleSubtask(sub, $event)" /> <span
                    class="subtask_description">{{ sub.subDescription }}</span>
            </label>
            }
        </div>
        }

        <div class="edit_delete">
            <button><img src="/assets/icons/delete.svg" alt="Delete">Delete</button>
            <span class="divider"></span>
            <button (click)="openEditOverlay(selectedTask)"><img src="/assets/icons/edit.svg" alt="Edit">Edit</button>
        </div>
        } @else {
        <app-edit-card-details [task]="editedTask" (close)="closeEditOverlay()">
        </app-edit-card-details>
        }

    </div>
</div>
}